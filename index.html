<canvas id="canvas1"></canvas>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
  background: black;
}
canvas {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 522px; 
    height: 353px;
    transform: translate(-50%, -50%);
    border: 1px solid black;
}

footer {
  font-family: monospace;
  width: 100%;
  color: white;
  font-size: 15px;
  margin-left: 5px;
  text-shadow: 1px 1px 1px #737373; 
  position: absolute;
  bottom: 0;
  width: 95%;
  text-align: center;
  padding-bottom: 15px;
}
footer a {
  color: orangered;
}
</style>

<footer>Created by <a href="https://www.youtube.com/channel/UCEqc149iR-ALYkGM6TG-7vQ" target='blank'>Frank's Laboratory</a> @2020.
</footer>
<script>
const image = new Image();
image.src = 'data:image/jpeg;base64,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';
image.addEventListener('load', function(){
    const canvas = document.getElementById('canvas1');
    const ctx = canvas.getContext('2d');
    canvas.width = 522;
    canvas.height = 353;

    let particlesArray = [];
    const numberOfParticles = 5000;
    const detail = 1;

    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    const pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let grid = [];
    for (let y = 0; y < canvas.height; y += detail){
        let row = [];
        for (let x = 0; x < canvas.width; x += detail){
            const red = pixels.data[(y * 4 * pixels.width) + (x * 4)]
            const green = pixels.data[(y * 4 * pixels.width) + (x * 4 + 1)]
            const blue = pixels.data[(y * 4 * pixels.width) + (x * 4 + 2)]
            const color = 'rgb(' + red +',' + green + ',' + blue + ')';
            const brightness = calculateBrightness(red, green, blue)/100;
            const cell = [
                cellColor = color,
                cellBrightness = brightness,
            ];
            row.push(cell);
        }  
        grid.push(row); 
    }
    console.log(grid);
    class Particle {
        constructor(){
            this.x = Math.random() * canvas.width;
            this.y = canvas.height;
            //this.prevX = this.x;
            this.speed = 0;
            this.velocity = Math.random() * 0.4;
            this.size = Math.random() * 2 + 0.5;
            this.position1 = Math.floor(this.y / detail);
            this.position2 = Math.floor(this.x / detail);
            this.angle = 0;
        }
        update () {
            this.position1 = Math.floor(this.y / detail);
            this.position2 = Math.floor(this.x / detail);
            if (grid[this.position1]){
                if (grid[this.position1][this.position2]){
                    this.speed = grid[this.position1][this.position2][1];
                }
            }
            this.angle += this.speed/20;
            let movement = (2.5 - this.speed) + this.velocity;
            this.y -= movement + Math.cos(this.angle) * 2;
            this.x += Math.cos(this.angle) * 2;
            if (this.y <= 0) {
                this.y = canvas.height;
                this.x = Math.random() * canvas.width;
            }
            //console.log(this.x += movement)
        }
        draw(){
            ctx.beginPath();
            ctx.fillStyle = 'black';
            if (this.y > canvas.height - this.size * 6) ctx.globalAlpha = 0;
            if (grid[this.position1]){
                if (grid[this.position1][this.position2]){
                    ctx.fillStyle = grid[this.position1][this.position2][0];
                }

            } else {
                ctx.fillStyle = 'white';
            }
            ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
            ctx.fill();

        }
    }

    function init(){
        for (let i = 0; i < numberOfParticles; i++){
            particlesArray.push(new Particle());
        }
    }
    init();

    function animate () {
        ctx.globalAlpha = 0.05;
        ctx.fillStyle = 'rgb(0, 0, 0)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 0.2;
        for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].update();
            ctx.globalAlpha = particlesArray[i].speed * 0.3;
            particlesArray[i].draw();
        }
        requestAnimationFrame( animate );
    }
    animate();

    function calculateBrightness(red, green, blue){
        return Math.sqrt(
            (red * red) * 0.299 +
            (green * green) * 0.587 +
            (blue * blue) * 0.114
        );
    }

});
</script>
